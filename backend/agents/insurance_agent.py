"""
Агент для генерации ответов по категории "Страхование" (ОСАГО, КАСКО и т.д.).

Этот агент специализируется на ответах, связанных с:
- Оформлением ОСАГО
- Оформлением КАСКО
- Страхованием жизни
- Страхованием имущества
- Вопросами по страховым полисам

Стиль: информативный, заботливый, с акцентом на защиту клиента.
"""

from backend.agents.base_agent import BaseAgent
from backend.services.yandex_ai import send_request_to_yandex


class InsuranceAgent(BaseAgent):
    """
    Агент для работы с запросами по страхованию.
    
    Генерирует ответы в заботливом, информативном стиле,
    подчеркивая важность защиты и безопасности.
    """
    
    def __init__(self):
        system_instruction = """Ты - специалист банка по страхованию.
Твоя задача - отвечать на обращения клиентов, связанные со страхованием (ОСАГО, КАСКО, страхование жизни и т.д.).

Стиль ответа:
- Заботливый и внимательный
- Информативный и понятный
- Подчеркивающий важность защиты
- Профессиональный, но дружелюбный

Обязательно:
- Объяснить преимущества страховой защиты
- Указать необходимые документы для оформления
- Предложить консультацию со специалистом
- Использовать корпоративный стиль банка"""
        
        super().__init__(
            name="Insurance Agent",
            system_instruction=system_instruction
        )
    
    def generate_response(self, letter_text: str) -> str:
        """
        Генерирует ответ на письмо, связанное со страхованием.
        
        Args:
            letter_text: Текст входящего письма
        
        Returns:
            str: Сгенерированный ответ
        """
        additional_instructions = """
Учти, что это запрос связан со страхованием.
Если клиент хочет оформить страховку (ОСАГО, КАСКО и т.д.):
- Объясни важность страховой защиты
- Укажи необходимые документы
- Предложи рассчитать стоимость
- Предложи записаться на консультацию

Если это вопрос по существующему полису:
- Предложи уточнить детали
- Направь в страховой отдел при необходимости"""
        
        prompt = self._build_prompt(letter_text, additional_instructions)
        response = send_request_to_yandex(prompt, temperature=0.7)
        
        return response

