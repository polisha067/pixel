"""
Агент для генерации ответов по категории "Кредиты".

Этот агент специализируется на ответах, связанных с:
- Оформлением кредитов
- Автокредитами
- Кредитными картами
- Рефинансированием кредитов
- Вопросами по кредитам

Стиль: деловой, информативный, заинтересованный в помощи клиенту.
"""

from backend.agents.base_agent import BaseAgent
from backend.services.yandex_ai import send_request_to_yandex


class CreditAgent(BaseAgent):
    """
    Агент для работы с запросами по кредитам.
    
    Генерирует ответы в деловом, но дружелюбном стиле,
    с акцентом на помощь клиенту в оформлении кредита.
    """
    
    def __init__(self):
        # Системная инструкция определяет роль и стиль агента
        system_instruction = """Ты - специалист банка по кредитованию.
Твоя задача - отвечать на обращения клиентов, связанные с кредитами.

Стиль ответа:
- Деловой, но дружелюбный
- Информативный и полезный
- Заинтересованный в помощи клиенту
- Профессиональный, но понятный

Обязательно:
- Предложить конкретные шаги для решения вопроса
- Указать необходимые документы (если применимо)
- Предложить связаться для консультации
- Использовать корпоративный стиль банка"""
        
        super().__init__(
            name="Credit Agent",
            system_instruction=system_instruction
        )
    
    def generate_response(self, letter_text: str) -> str:
        """
        Генерирует ответ на письмо, связанное с кредитами.
        
        Args:
            letter_text: Текст входящего письма
        
        Returns:
            str: Сгенерированный ответ
        """
        # Дополнительные инструкции для кредитных запросов
        additional_instructions = """
Учти, что это запрос связан с кредитованием.
Если клиент хочет оформить кредит:
- Укажи основные условия
- Перечисли необходимые документы
- Предложи записаться на консультацию

Если это вопрос по существующему кредиту:
- Предложи уточнить детали
- Направь в соответствующий отдел при необходимости"""
        
        # Строим полный промпт
        prompt = self._build_prompt(letter_text, additional_instructions)
        
        # Отправляем запрос к нейросети
        # temperature=0.7 - средняя температура для баланса между точностью и естественностью
        response = send_request_to_yandex(prompt, temperature=0.7)
        
        return response

