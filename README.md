# Система обработки писем банка

Веб-приложение для автоматизации обработки входящих писем клиентов банка. Система анализирует письма, маршрутизирует их по специализациям сотрудников и генерирует ответы с помощью нейросети.

## Что это

Система состоит из двух интерфейсов - для клиентов и для сотрудников банка. Клиенты отправляют письма через веб-интерфейс, система автоматически определяет тип запроса и направляет его нужному специалисту. Сотрудники могут генерировать ответы с помощью AI или писать их вручную.

## Технологии

- Backend: FastAPI, SQLAlchemy, SQLite
- AI: Yandex Cloud Qwen3-235B
- Frontend: HTML/CSS/JavaScript
- Авторизация: сессии через заголовки

## Быстрый старт

### Через Docker

1. Скопируйте `env.example` в `.env` и заполните ключи Yandex Cloud:
```
api_key=ваш_ключ
folder_id=ваш_folder_id
```

2. Запустите:
```bash
docker-compose up --build
```

Приложение будет доступно на http://localhost:8001

### Локально

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Создайте `.env` файл с ключами Yandex Cloud

3. Запустите сервер:
```bash
cd backend
python main.py
```

## Использование

### Клиенты

После регистрации можно отправлять письма в банк. Система автоматически анализирует письмо, определяет специализацию и назначает его соответствующему сотруднику. Когда ответ готов, он появится в вашем личном кабинете.

### Сотрудники

В панели сотрудника отображаются все письма, отфильтрованные по вашей специализации. Можно взять письмо в работу, сгенерировать ответ через AI или написать вручную. После одобрения ответ отправляется клиенту.

## Структура проекта

```
backend/
  main.py          - точка входа, инициализация приложения
  routers.py       - все API эндпоинты
  funcs.py         - вспомогательные функции
  ai_funcs.py      - функции для работы с AI
  models.py        - модели базы данных
  database.py      - настройка БД и работа с паролями
  rag_system.py    - система поиска по базе знаний
  knowledge_base/  - текстовые файлы с информацией о продуктах банка

frontend/
  *.html           - страницы интерфейса
  styles.css       - стили
  script.js        - клиентская логика
```

## Настройки

В `.env` файле можно настроить:
- `api_key` - ключ API Yandex Cloud (обязательно)
- `folder_id` - ID папки в Yandex Cloud (обязательно)
- `HOST` - хост сервера (по умолчанию 127.0.0.1)
- `PORT` - порт сервера (по умолчанию 8001)
- `RESET_DB` - очистка БД при запуске (true/false)

## База данных

Используется SQLite, файл создается автоматически в `backend/bank_system.db`. При первом запуске создаются таблицы для пользователей, писем и бизнес-информации о клиентах.

## API

Основные эндпоинты:
- `POST /api/register` - регистрация
- `POST /api/login` - авторизация
- `POST /api/letters` - создание письма (клиент)
- `GET /api/letters/my` - мои письма (клиент)
- `GET /api/letters/all` - все письма (сотрудник)
- `POST /api/letters/{id}/process` - генерация ответа
- `POST /api/letters/{id}/approve` - одобрение ответа

Полный список маршрутов выводится в консоль при запуске сервера.

## Особенности

- Автоматическая маршрутизация писем по специализациям
- Извлечение бизнес-информации о клиентах из писем
- Использование истории переписки при генерации ответов
- RAG система для поиска информации в базе знаний банка
- Автоматическое определение дедлайнов и типов писем
